import{f as e}from"./vendor.2356b38d.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,c)=>{const i=new URL(e,o);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const d=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(d),onerror(){c(new Error(`Failed to import: ${e}`)),a(s)},onload(){n(self[t].moduleMap[i]),a(s)}});document.head.appendChild(s)})),self[t].moduleMap={}}}("/remote-webrtc/assets/");const t={apiKey:"AIzaSyBwKaw1gp8Qr1_NFEbm5_-m_2-M5_JqvMo",authDomain:"webrtc-81ec9.firebaseapp.com",projectId:"webrtc-81ec9",storageBucket:"webrtc-81ec9.appspot.com",messagingSenderId:"105366870931",appId:"1:105366870931:web:7af0858755e09250496666"};e.apps.length||e.initializeApp(t);const n=e.firestore(),o=new RTCPeerConnection({iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10});let a=null,c=null;const d=document.getElementById("webcamButton"),s=document.getElementById("webcamVideo"),l=document.getElementById("callButton"),r=document.getElementById("callInput"),m=document.getElementById("answerButton"),u=document.getElementById("remoteVideo"),p=document.getElementById("hangupButton"),g=document.getElementById("OfferSDP"),f=document.getElementById("OfferICE"),w=document.getElementById("AnswerSDP"),y=document.getElementById("AnswerICE"),C=document.getElementById("receiveOfferButton"),I=document.getElementById("receiveAnswerButton");d.onclick=async()=>{a=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),c=new MediaStream,a.getTracks().forEach((e=>{o.addTrack(e,a)})),o.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{c.addTrack(e)}))},s.srcObject=a,u.srcObject=c,l.disabled=!1,m.disabled=!1,d.disabled=!0},l.onclick=async()=>{const e=n.collection("calls").doc(),t=e.collection("offerCandidates"),a=e.collection("answerCandidates");r.value=e.id,o.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON()),console.log(`OnICECandidate event OFFER SIDE: ${JSON.stringify(e)}`),f.value=f.value+JSON.stringify(e.candidate)};const c=await o.createOffer();await o.setLocalDescription(c);const i={sdp:c.sdp,type:c.type};console.log(`SDP document details: ${JSON.stringify(i)}`);const d=JSON.stringify(i);console.log(d),g.value=d.replace("\r\n",""),await e.set({offer:i}),e.onSnapshot((e=>{const t=e.data();if(console.log(`onSnapshot data in DB: ${JSON.stringify(t)}`),!o.currentRemoteDescription&&(null==t?void 0:t.answer)){const e=new RTCSessionDescription(t.answer);o.setRemoteDescription(e)}})),a.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());o.addIceCandidate(t)}}))})),p.disabled=!1},m.onclick=async()=>{console.log(" Answer button clicked");const e=r.value,t=n.collection("calls").doc(e),a=t.collection("answerCandidates"),c=t.collection("offerCandidates");o.onicecandidate=e=>{e.candidate&&a.add(e.candidate.toJSON()),Answer.value=Answer.value+JSON.stringify(e.candidate),console.log(`OnICECandidate event ANSWER SIDE: ${JSON.stringify(e)}`)},console.log("Trying to get the offer call data");const i=(await t.get()).data();console.log(`Call data: ${JSON.stringify(i)}`);const d=i.offer;await o.setRemoteDescription(new RTCSessionDescription(d));const s=await o.createAnswer();await o.setLocalDescription(s),console.log(`answerDescription: ${JSON.stringify(s)}`);const l={type:s.type,sdp:s.sdp};await t.update({answer:l}),c.onSnapshot((e=>{e.docChanges().forEach((e=>{if(console.log(`change is : ${JSON.stringify(e)}`),"added"===e.type){let t=e.doc.data();o.addIceCandidate(new RTCIceCandidate(t))}}))}))},C.onclick=async()=>{o.setRemoteDescription(new RTCSessionDEscription(g.value));const e=await o.createAnswer();for(await o.setLocalDescription(e),console.log(`answerDescription: ${JSON.stringify(e)}`),i=0;i<f.value.length;i++)o.addIceCandidate(new RTCIceCandidate(f.value[i]))},I.onclick=async()=>{for(o.setRemoteDescription(w.value),i=0;i<f.value.length;i++)o.addIceCandidate(new RTCIceCandidate(y.value[i]))};
